var sk = new Object();
var update = new Object();
var origin = window.location.origin;
var path = window.location.pathname;

// ajax加载页面
sk.loadPage = function (url, id) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (xhr.readyState == 4 && xhr.status == 200) {
      document.getElementById(id).innerHTML = xhr.responseText;
    }
  };
  xhr.open("GET", url, true);
  xhr.send();
};



// 时间戳
sk.time = function () {
  return Date.parse(new Date());
};

// 获取内容
sk.getContent = function (data) {
  return document.getElementsByClassName(data)[0].innerHTML;
};

sk.getData = function () {
  var url = location.search; //获取url中"?"符后的字串
  var theRequest = new Object();
  if (url.indexOf("?") != -1) {
    var str = url.substr(1);
    strs = str.split("&");
    for (var i = 0; i < strs.length; i++) {
      theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
    }
  }
  return theRequest;
};

sk.sleep = function (time) {
  return new Promise((resolve) => setTimeout(resolve, time));
};

// 未保存提示
sk.noSave = function () {
  window.onbeforeunload = function () {
    return true;
  };
};

// 登陆
sk.login = function () {
  window.location.href = "/admin";
};

// 登出操作
sk.loginOut = function () {
  $.ajax({
    url: "/api/loginOut",
    method: "POST",
    success: function (data) {
      if (data.code == 200) {
        window.location.href = "";
      } else {
        alert("未登陆");
      }
    },
  });
};

// 图片异常处理
sk.imgErr = function () {
  var img = event.srcElement;
  img.src = origin + "/sk-content/upload/fish.jpg";
  img.onerror = null;
};

// 更新检查
update.check = function (callback) {
  axios.post("/api/update/check").then(function (response) {
    callback(response.data);
  });
};

// 执行更新
update.do = function (callback) {
  axios.post("/api/update/do").then(function (response) {
    callback(response.data);
  });
};
